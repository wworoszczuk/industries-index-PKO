<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indeks Atrakcyjno≈õci Bran≈ºowej | PKO BP</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; } 

        :root {
            --pko-blue: #003C71;
            --pko-navy: #2D384D;
            --pko-light: #F2F2F2;
            --pko-red: #D31145;
            --pko-green: #008A4B;
            --pko-yellow: #B56800; /* Bardziej czytelny ≈º√≥≈Çty */
            --text-main: #333333;
            --white: #FFFFFF;
        }

        body { font-family: 'Roboto', sans-serif; background-color: #F7F8FA; color: var(--text-main); margin: 0; padding: 0; overflow-x: hidden; }
        
        /* HEADER */
        header { background-color: var(--pko-blue); color: var(--white); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo-area img { vertical-align: middle; }
        
        .header-meta { display: flex; align-items: center; gap: 15px; }
        
        .methodology-btn {
            background: rgba(255,255,255,0.15); color: white; text-decoration: none; padding: 6px 15px; border-radius: 4px; font-size: 0.85rem; transition: background 0.2s; border: 1px solid rgba(255,255,255,0.2);
        }
        .methodology-btn:hover { background: rgba(255,255,255,0.3); }
        .date-badge { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; }

        /* LAYOUT */
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 20px; height: calc(100vh - 80px); }
        
        .card { background: var(--white); border-radius: 8px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); height: 100%; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        h2 { font-size: 1.1rem; color: var(--pko-navy); margin-top: 0; border-bottom: 2px solid var(--pko-light); padding-bottom: 10px; flex-shrink: 0; }

        /* LISTS */
        .industry-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; }
        .industry-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; border-radius: 4px; }
        .industry-item:hover { background-color: #f0f4f8; }
        
        .name-group { flex-grow: 1; padding: 0 10px; }
        .ind-name { font-weight: 500; font-size: 0.9rem; display: block; line-height: 1.2; }
        .ind-code { font-size: 0.75rem; color: #888; }
        .rank-badge { font-weight: bold; font-size: 0.9rem; width: 30px; color: #999; }

        .score-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.85rem; min-width: 35px; text-align: center; }
        .score-good { background: #E6F4EA; color: var(--pko-green); }
        .score-med { background: #FFF4E5; color: var(--pko-yellow); }
        .score-bad { background: #FDE7E9; color: var(--pko-red); }

        /* DETAIL VIEW */
        #detailView { display: flex; flex-direction: column; height: 100%; padding-bottom: 5px; }
        .detail-header { text-align: center; margin-bottom: 15px; flex-shrink: 0; }
        
        /* NOWY WYGLƒÑD PUNKTACJI */
        .score-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .main-score-box {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            background: #ccc; /* Default */
            padding: 10px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .forecast-info {
            text-align: left;
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }
        .forecast-val { font-weight: bold; color: #333; }

        .chart-container { position: relative; flex-grow: 1; min-height: 250px; width: 100%; display: flex; justify-content: center; align-items: center; }
        
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; flex-shrink: 0; margin-bottom: 5px; }
        .metric-box { background: #F8F9FA; padding: 15px 5px; border-radius: 6px; text-align: center; border: 1px solid #eee; }
        .metric-val { display: block; font-weight: bold; font-size: 1.1rem; color: var(--pko-navy); }
        .metric-lbl { font-size: 0.7rem; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 5px; }

        .btn-full-list { margin-top: 15px; width: 100%; padding: 10px; background: #eee; border: none; border-radius: 4px; cursor: pointer; color: #555; font-weight: bold; transition: 0.2s; flex-shrink: 0; }
        .btn-full-list:hover { background: #ddd; }

        /* MODAL */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; padding: 25px; border-radius: 8px; width: 90%; max-width: 800px; height: 85vh; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; flex-shrink: 0; }
        .modal-header h2 { margin: 0; border: none; padding: 0; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close:hover { color: #000; }
        .modal-list-container { overflow-y: auto; flex-grow: 1; padding-right: 5px; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #aaa; }

        footer { text-align: center; padding: 1rem; color: #888; font-size: 0.75rem; background: #F7F8FA; width: 100%; }
    </style>
</head>
<body>

<header>
    <div class="logo-area">
        <img src="assets/logo.svg" alt="Logo PKO BP" id="logo" height="30px">
    </div>
    <div class="header-meta">
        <a href="metodologia.html" class="methodology-btn">üìñ Metodologia</a>
        <div class="date-badge" id="dataDate">DANE: GUS F-01 (Q1-Q3 2025)</div>
    </div>
</header>

<div class="container">
    <div class="card">
        <h2>üöÄ Liderzy Rynku (Top 10)</h2>
        <ul class="industry-list" id="topList">
            <div class="loading">≈Åadowanie danych...</div>
        </ul>
        <button class="btn-full-list" onclick="openModal()">Zobacz pe≈Çny ranking</button>
    </div>

    <div class="card" style="border-top: 4px solid var(--pko-blue);">
        <div id="detailView" style="display:none;"> 
            <div class="detail-header">
                <h3 id="detName" style="margin:0; font-size:1.4rem; color: var(--pko-navy);">--</h3>
                <span id="detCode" style="color:#888; font-size:0.9rem;">PKD --</span>
                
                <div class="score-container">
                    <div class="main-score-box" id="detScore">--</div>
                    <div class="forecast-info">
                        Prognoza: <span class="forecast-val" id="detForecast">--</span><br>
                        Perspektywa: <span id="detOutlook" style="font-weight:bold;">--</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>

            <div class="metrics-grid">
                <div class="metric-box">
                    <span class="metric-val" id="detFirms">--</span>
                    <span class="metric-lbl">Liczba Firm (F-01)</span>
                </div>
                <div class="metric-box">
                    <span class="metric-val" id="detFailures">--</span>
                    <span class="metric-lbl">Upad≈Ço≈õci (2024)</span>
                </div>
                <div class="metric-box">
                    <span class="metric-val" id="detRos">-- %</span>
                    <span class="metric-lbl">Rentowno≈õƒá Netto (ROS)</span>
                </div>
            </div>
        </div>
        <div id="welcomeMsg" style="text-align:center; padding:50px; color:#888; display:flex; align-items:center; justify-content:center; height:100%;">
            <div>
                <h3 style="color:#ccc;">Wybierz bran≈ºƒô</h3>
                <p>Kliknij na element z listy, aby zobaczyƒá analizƒô.</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>‚ö†Ô∏è Obszary Ryzyka</h2>
        <ul class="industry-list" id="botList">
            <div class="loading">≈Åadowanie danych...</div>
        </ul>
    </div>
</div>

<div id="myModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
        <h2>Pe≈Çny Ranking Bran≈º (Wg IAB)</h2>
        <span class="close" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-list-container">
        <ul class="industry-list" id="fullList"></ul>
    </div>
  </div>
</div>

<div style="height: 50px;"></div>

<script>
    let myRadarChart = null;
    let allData = [];

    async function fetchData() {
        try {
            const response = await fetch('../output/iab_data.json'); 
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            allData = await response.json();
            
            const validData = allData.filter(d => d.iab !== null);
            validData.sort((a, b) => b.iab - a.iab);
            initDashboard(validData);

        } catch (error) {
            console.error(error);
            document.getElementById('topList').innerHTML = "B≈ÇƒÖd danych.";
        }
    }

    function initDashboard(data) {
        renderList('topList', data.slice(0, 10), true);
        renderList('botList', data.slice().reverse().slice(0, 10), false);
        renderList('fullList', data, true);

        if (data.length > 0) loadDetail(data[0]);
    }

    function renderList(elementId, items, isTop) {
        const list = document.getElementById(elementId);
        list.innerHTML = '';
        
        items.forEach((item, index) => {
            const li = document.createElement('li');
            li.className = 'industry-item';
            li.onclick = () => { closeModal(); loadDetail(item); };
            
            let badgeClass = 'score-med';
            if (item.iab >= 70) badgeClass = 'score-good';
            if (item.iab < 40) badgeClass = 'score-bad';
            
            let rank = "#";
            if (elementId === 'topList' || elementId === 'fullList') rank = index + 1;
            else if (elementId === 'botList') rank = allData.length - index; 

            li.innerHTML = `
                <span class="rank-badge">${rank}</span>
                <div class="name-group">
                    <span class="ind-name">${item.nazwa}</span>
                    <span class="ind-code">PKD ${item.pkd}</span>
                </div>
                <div class="score-badge ${badgeClass}">${item.iab.toFixed(0)}</div>
            `;
            list.appendChild(li);
        });
    }

    function loadDetail(item) {
        document.getElementById('welcomeMsg').style.display = 'none';
        document.getElementById('detailView').style.display = 'flex';

        document.getElementById('detName').innerText = item.nazwa;
        document.getElementById('detCode').innerText = `PKD ${item.pkd} | Sekcja ${item.sekcja}`;
        
        // --- NOWY SPOS√ìB WY≈öWIETLANIA PUNKTACJI ---
        const scoreBox = document.getElementById('detScore');
        scoreBox.innerText = item.iab.toFixed(1);
        
        // Kolorowanie t≈Ça wyniku
        if (item.iab >= 70) scoreBox.style.background = 'var(--pko-green)';
        else if (item.iab < 40) scoreBox.style.background = 'var(--pko-red)';
        else scoreBox.style.background = 'var(--pko-yellow)';

        // Prognoza
        document.getElementById('detForecast').innerText = item.iab_forecast ? item.iab_forecast.toFixed(1) : '-';
        
        // Outlook
        const outlookEl = document.getElementById('detOutlook');
        outlookEl.innerText = item.outlook || '-';
        if (item.outlook && item.outlook.includes('Pozytywna')) outlookEl.style.color = 'var(--pko-green)';
        else if (item.outlook && item.outlook.includes('Negatywna')) outlookEl.style.color = 'var(--pko-red)';
        else outlookEl.style.color = '#666';

        // Reszta
        document.getElementById('detFirms').innerText = item.firmy.toLocaleString('pl-PL');
        document.getElementById('detFailures').innerText = item.upadlosci.toLocaleString('pl-PL');
        
        const rosVal = item.finanse_ros !== undefined ? item.finanse_ros : 0;
        const rosEl = document.getElementById('detRos');
        rosEl.innerText = `${rosVal.toFixed(1)}%`;
        rosEl.style.color = rosVal >= 0 ? 'var(--pko-green)' : 'var(--pko-red)';

        setTimeout(() => updateChart(item), 50);
    }

    function updateChart(item) {
        const ctx = document.getElementById('radarChart').getContext('2d');
        const c = item.components;
        if (myRadarChart) myRadarChart.destroy();

        myRadarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Bezpiecze≈Ñstwo', 'Rentowno≈õƒá', 'P≈Çynno≈õƒá', 'Ryzyko', 'Innowacje', 'Makro', 'Trendy'],
                datasets: [{
                    label: 'Wynik punktowy',
                    data: [c.SH, c.SP, 50, 100 - c.RR, c.AI, c.MC, c.GT],
                    backgroundColor: 'rgba(0, 60, 113, 0.2)',
                    borderColor: '#003C71',
                    pointBackgroundColor: '#D31145',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { display: false } } },
                plugins: { legend: { display: false } }
            }
        });
    }

    function openModal() { document.getElementById("myModal").style.display = "flex"; document.body.style.overflow = "hidden"; }
    function closeModal() { document.getElementById("myModal").style.display = "none"; document.body.style.overflow = "auto"; }
    window.onclick = function(event) { if (event.target == document.getElementById("myModal")) closeModal(); }

    fetchData();
</script>

</body>
</html>